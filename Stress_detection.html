<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Stress Detection Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white p-8 rounded-xl shadow-2xl max-w-3xl w-full border-t-8 border-emerald-600">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Proactive Stress Detection System</h1>
            <p class="text-md text-slate-600">A real-time demo with a Gradient Boosting-like model</p>
        </header>

        <section class="mb-8">
            <div class="bg-slate-100 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-slate-800 mb-2">How to use this demo:</h2>
                <p class="text-slate-600 mb-4">This app simulates a multimodal machine learning model. Enter values for key employee indicators and a daily check-in message, then click "Analyze" to see its prediction. This demonstrates how a system would combine different types of data for a comprehensive result.</p>
                <ul class="list-disc list-inside text-sm text-slate-500 space-y-1">
                    <li>**To show stress:** Try setting a high heart rate, low sleep, and a negative message.</li>
                    <li>**To show well-being:** Try a normal heart rate, good sleep, and a positive message.</li>
                </ul>
            </div>
        </section>
        
        <section>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="heart-rate-input" class="block text-slate-700 font-semibold mb-2">Heart Rate (bpm):</label>
                    <input type="number" id="heart-rate-input" value="70" min="0" max="150" class="w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors">
                </div>
                <div>
                    <label for="sleep-hours-input" class="block text-slate-700 font-semibold mb-2">Hours of Sleep:</label>
                    <input type="number" id="sleep-hours-input" value="8" min="0" max="15" class="w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors">
                </div>
                <div>
                    <label for="working-hours-input" class="block text-slate-700 font-semibold mb-2">Working Hours (per day):</label>
                    <input type="number" id="working-hours-input" value="8" min="0" max="16" class="w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors">
                </div>
                <div>
                    <label for="performance-input" class="block text-slate-700 font-semibold mb-2">Work Performance:</label>
                    <select id="performance-input" class="w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors">
                        <option value="good">Meets/Exceeds Expectations</option>
                        <option value="average">Meets Expectations (but with a lot of effort)</option>
                        <option value="poor">Needs Improvement</option>
                    </select>
                </div>
            </div>
            
            <label for="text-input" class="block text-slate-700 font-semibold mb-2">Daily Check-in Message:</label>
            <textarea id="text-input" rows="4" class="w-full p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 mb-4 transition-colors" placeholder="e.g., 'The project deadline is looming, and I'm a bit anxious.'"></textarea>
            
            <div class="flex items-center space-x-4 mb-8">
              <button id="analyze-button" class="bg-emerald-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-emerald-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Analyze</button>
              <button id="clear-button" class="bg-slate-300 text-slate-800 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-slate-400 transition-colors">Clear All</button>
              <div id="loading-spinner" class="hidden animate-spin rounded-full h-8 w-8 border-4 border-b-emerald-600"></div>
            </div>
            
            <div id="result-container" class="mt-8 p-6 rounded-lg hidden">
                <h3 class="text-xl font-semibold text-slate-800 mb-2">Prediction:</h3>
                <div class="flex items-center space-x-4 mb-4">
                    <p class="text-2xl font-bold"><span id="stress-result"></span></p>
                    <div class="w-40 bg-slate-200 rounded-full h-2.5">
                        <div id="confidence-bar" class="h-2.5 rounded-full transition-all duration-500"></div>
                    </div>
                </div>
                <div id="advice-message-container" class="flex items-start p-4 rounded-lg">
                    <div id="advice-icon" class="text-2xl mr-4"></div>
                    <div>
                        <p id="advice-message" class="text-sm text-slate-700"></p>
                        <ul id="advice-details" class="list-disc list-inside text-sm text-slate-600 mt-2 space-y-1"></ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="history-section" class="mt-8 pt-8 border-t border-slate-200 hidden">
            <h2 class="2xl font-bold text-slate-900 mb-4 text-center">Analysis History & Trends</h2>
            <div class="bg-slate-100 p-4 rounded-lg shadow-inner mb-4 flex flex-col sm:flex-row items-center justify-between">
                <div class="flex items-center space-x-4 mb-2 sm:mb-0">
                    <p class="text-sm font-medium text-slate-600">Set Custom Thresholds:</p>
                    <div class="flex items-center space-x-1">
                        <label for="stressed-threshold" class="text-sm">Stressed (>=)</label>
                        <input type="number" id="stressed-threshold" value="3.0" step="0.5" min="0" max="6" class="w-16 p-1 text-xs border rounded-md">
                    </div>
                    <div class="flex items-center space-x-1">
                        <label for="monitoring-threshold" class="text-sm">Monitoring (>=)</label>
                        <input type="number" id="monitoring-threshold" value="1.0" step="0.5" min="0" max="6" class="w-16 p-1 text-xs border rounded-md">
                    </div>
                </div>
                <button id="reset-thresholds-button" class="bg-slate-200 text-slate-700 text-xs py-1 px-4 rounded-lg hover:bg-slate-300 transition-colors">Reset Thresholds</button>
            </div>
            <div class="chart-container w-full h-[300px] mb-8">
                <canvas id="history-chart"></canvas>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border-collapse rounded-lg overflow-hidden shadow-lg">
                    <thead>
                        <tr class="bg-slate-200 text-slate-700">
                            <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Time</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Prediction</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">HR</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Sleep</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Work Hours</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Perf.</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body" class="divide-y divide-slate-200">
                        
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const analyzeButton = document.getElementById('analyze-button');
            const clearButton = document.getElementById('clear-button');
            const heartRateInput = document.getElementById('heart-rate-input');
            const sleepHoursInput = document.getElementById('sleep-hours-input');
            const workingHoursInput = document.getElementById('working-hours-input');
            const performanceInput = document.getElementById('performance-input');
            const textInput = document.getElementById('text-input');
            const loadingSpinner = document.getElementById('loading-spinner');
            const resultContainer = document.getElementById('result-container');
            const stressResult = document.getElementById('stress-result');
            const confidenceBar = document.getElementById('confidence-bar');
            const adviceMessageContainer = document.getElementById('advice-message-container');
            const adviceIcon = document.getElementById('advice-icon');
            const adviceMessage = document.getElementById('advice-message');
            const adviceDetailsList = document.getElementById('advice-details');
            const historySection = document.getElementById('history-section');
            const historyTableBody = document.getElementById('history-table-body');
            const historyChartCanvas = document.getElementById('history-chart').getContext('2d');
            const stressedThresholdInput = document.getElementById('stressed-threshold');
            const monitoringThresholdInput = document.getElementById('monitoring-threshold');
            const resetThresholdsButton = document.getElementById('reset-thresholds-button');

            let analysisHistory = [];
            let historyChart;
            const defaultStressedThreshold = 3.0;
            const defaultMonitoringThreshold = 1.0;

            
            function simulatePrediction(heartRate, sleepHours, workingHours, performance, text) {
                
                const lowerText = text.toLowerCase();
                const stressedKeywords = ['overwhelmed', 'tired', 'stressed', 'anxious', 'pressure', 'difficult', 'stressful', 'burnout', 'falling behind', 'behind', 'not well', 'tried'];
                const positiveKeywords = ['motivated', 'productive', 'happy', 'great', 'smoothly', 'well', 'excited', 'confident', 'on track', 'alright'];

                let isStressedText = false;
                for (const keyword of stressedKeywords) {
                    if (lowerText.includes(keyword)) {
                        isStressedText = true;
                        break;
                    }
                }
                
                if (isStressedText) {
                     let detailMessages = [];
                     let contributingFactors = [];
                     
                     if (heartRate > 80) {
                         contributingFactors.push(`Your heart rate is elevated at ${heartRate} bpm.`);
                     }
                     if (sleepHours < 8 && sleepHours > 0) {
                         contributingFactors.push(`Your sleep of ${sleepHours} hours is below the recommended amount.`);
                     }
                     if (workingHours > 9) {
                         contributingFactors.push(`Your working hours of ${workingHours} per day are a key factor.`);
                     }
                     if (performance === 'poor') {
                         contributingFactors.push(`Your work performance is a contributing factor.`);
                     } else if (performance === 'average') {
                         contributingFactors.push(`Your work performance shows some strain.`);
                     }

                     detailMessages.push("Your message contains stress-related keywords. This is the primary factor in this prediction.");
                     if(contributingFactors.length > 0) {
                         detailMessages.push("Other factors contributing to this prediction include:");
                         detailMessages.push(...contributingFactors);
                     } else {
                         detailMessages.push("All other metrics seem to be in a normal range, but the model is prioritizing your self-reported feelings.");
                     }


                     return { 
                        prediction: "Stressed", 
                        confidence: (Math.random() * 0.15 + 0.85),
                        advice: "We hear your feelings of stress. Taking a break and talking to someone you trust can be a great first step.",
                        numericalStressScore: 3.5,
                        details: detailMessages
                     };
                }

                
                if (heartRate === 0 && sleepHours === 0 && workingHours === 0 && performance === 'good' && text.trim() === '') {
                    return {
                        prediction: "Perfect Score",
                        confidence: 1.0,
                        advice: "All metrics are perfect! You're in a great place for well-being and productivity.",
                        numericalStressScore: 0.0,
                        details: []
                    };
                }
                
                let total_score = 0;
                let detailMessages = [];

                // Feature 1: Heart Rate (Physiological)
                if (heartRate > 100) {
                    total_score += 2.5;
                    detailMessages.push(`Your heart rate is above 100 bpm, which is a key indicator of high stress.`);
                } else if (heartRate > 90) {
                    total_score += 1.5;
                    detailMessages.push(`Your heart rate is elevated at ${heartRate} bpm, which may indicate a higher level of stress.`);
                } else if (heartRate > 80) {
                    total_score += 0.5;
                    detailMessages.push(`Your heart rate is slightly elevated at ${heartRate} bpm, but within a healthy range.`);
                }
                
                // Feature 2: Sleep Hours (Behavioral)
                if (sleepHours < 8 && sleepHours > 0) {
                    total_score += 1.0;
                    detailMessages.push(`Your sleep of ${sleepHours} hours is less than the recommended 8+ hours.`);
                } else if (sleepHours < 6 && sleepHours > 0) {
                    total_score += 1.5;
                    detailMessages.push("Your sleep of less than 6 hours is significantly below the recommended amount.");
                } else if (sleepHours >= 8) {
                    detailMessages.push(`Your sleep of ${sleepHours} hours is within the healthy range.`);
                }


                // Feature 3: Working Hours (Contextual)
                if (workingHours > 9) {
                    total_score += 1.5;
                    detailMessages.push(`Your working hours (${workingHours} hours per day) are above the recommended 8-9 hour range.`);
                } else if (workingHours < 8 && workingHours > 0) {
                    total_score += 0.5;
                    detailMessages.push(`Your working hours (${workingHours} hours per day) are below the recommended 8-9 hour range.`);
                } else if (workingHours >=8 && workingHours <= 9) {
                    detailMessages.push(`Your working hours (${workingHours} hours per day) are within the recommended range.`);
                }
                
                // Feature 4: Work Performance (Contextual)
                if (performance === 'poor') {
                    total_score += 1.5;
                    detailMessages.push("Your work performance of 'Needs Improvement' is a key factor in the prediction.");
                } else if (performance === 'average') {
                    total_score += 0.5;
                    detailMessages.push("Your work performance of 'Meets Expectations (but with a lot of effort)' contributes to the score.");
                } else if (performance === 'good') {
                    detailMessages.push("Your work performance is currently meeting or exceeding expectations.");
                }
                
                let isPositiveText = false;
                if (text.trim() !== '') {
                    for (const keyword of positiveKeywords) {
                        if (lowerText.includes(keyword)) {
                            isPositiveText = true;
                            total_score -= 1.0;
                            detailMessages.push(`Your message contains a positive keyword: '${keyword}'.`);
                            break;
                        }
                    }
                } else {
                    detailMessages.push("No check-in message was provided.");
                }

                let prediction, confidence, advice;
                const stressedThreshold = parseFloat(stressedThresholdInput.value);
                const monitoringThreshold = parseFloat(monitoringThresholdInput.value);
                
                if (total_score >= stressedThreshold) { 
                    prediction = "Stressed";
                    confidence = (Math.random() * 0.15 + 0.85);
                    advice = "It looks like you might be feeling overwhelmed. Taking a short break, walking around, or talking to a coworker can help. Your well-being is important.";
                } else if (total_score >= monitoringThreshold) { 
                     prediction = "Needs Monitoring";
                     confidence = (Math.random() * 0.1 + 0.7);
                     advice = "Your current metrics suggest you should keep an eye on your well-being. Try to find some time to de-stress this week.";
                } else { 
                    prediction = "Not Stressed";
                    confidence = (Math.random() * 0.15 + 0.85);
                    advice = "Your well-being metrics look great! To maintain this, a consistent sleep schedule can be very beneficial.";
                }


                return { prediction, confidence, advice, numericalStressScore: total_score, details: detailMessages };
            }

            function renderHistoryChart() {
                if (historyChart) {
                    historyChart.destroy();
                }

                const labels = analysisHistory.map((entry, index) => `Entry ${analysisHistory.length - index}`);
                const dataPoints = analysisHistory.map(entry => entry.numericalStressScore);

                const stressedThreshold = parseFloat(stressedThresholdInput.value);
                const monitoringThreshold = parseFloat(monitoringThresholdInput.value);
                
                const backgroundColors = dataPoints.map(score => {
                    if (score >= stressedThreshold) return 'rgba(239, 68, 68, 0.8)';
                    if (score >= monitoringThreshold) return 'rgba(251, 191, 36, 0.8)';
                    if (score <= 0) return 'rgba(16, 185, 129, 1.0)';
                    return 'rgba(16, 185, 129, 0.8)';
                });

                const borderColors = dataPoints.map(score => {
                    if (score >= stressedThreshold) return 'rgb(239, 68, 68)';
                    if (score >= monitoringThreshold) return 'rgb(251, 191, 36)';
                    if (score <= 0) return 'rgb(16, 185, 129)';
                    return 'rgb(16, 185, 129)';
                });

                historyChart = new Chart(historyChartCanvas, {
                    type: 'line',
                    data: {
                        labels: labels.reverse(),
                        datasets: [{
                            label: 'Stress Score',
                            data: dataPoints.reverse(),
                            borderColor: borderColors.reverse(),
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            pointBackgroundColor: backgroundColors.reverse(),
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 6,
                                title: {
                                    display: true,
                                    text: 'Stress Score',
                                    color: '#475569'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#475569'
                                }
                            }
                        }
                    }
                });
            }

            function renderHistoryTable() {
                historyTableBody.innerHTML = '';
                if (analysisHistory.length > 0) {
                    historySection.classList.remove('hidden');
                    analysisHistory.forEach(entry => {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-slate-50 transition-colors';
                        let textColorClass = 'text-emerald-600';
                        if (entry.prediction === 'Stressed') {
                            textColorClass = 'text-red-600';
                        } else if (entry.prediction === 'Needs Monitoring') {
                            textColorClass = 'text-yellow-600';
                        }
                        
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${entry.time}</td>
                            <td class="px-6 py-4 whitespace-nowrap font-medium text-sm ${textColorClass}">${entry.prediction}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${entry.heartRate}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${entry.sleepHours}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${entry.performance}</td>
                        `;
                        historyTableBody.appendChild(row);
                    });
                }
            }
            
            clearButton.addEventListener('click', () => {
                analysisHistory = [];
                historyTableBody.innerHTML = '';
                historySection.classList.add('hidden');
                resultContainer.classList.add('hidden');
                heartRateInput.value = '70';
                sleepHoursInput.value = '8';
                workingHoursInput.value = '8';
                performanceInput.value = 'good';
                textInput.value = '';
                if (historyChart) {
                    historyChart.destroy();
                }
            });

            resetThresholdsButton.addEventListener('click', () => {
                stressedThresholdInput.value = defaultStressedThreshold;
                monitoringThresholdInput.value = defaultMonitoringThreshold;
                if (analysisHistory.length > 0) {
                    renderHistoryChart();
                }
            });

            analyzeButton.addEventListener('click', () => {
                const heartRate = parseInt(heartRateInput.value);
                const sleepHours = parseInt(sleepHoursInput.value);
                const workingHours = parseInt(workingHoursInput.value);
                const performance = performanceInput.value;
                const text = textInput.value.trim();

                loadingSpinner.classList.remove('hidden');
                resultContainer.classList.add('hidden');
                analyzeButton.disabled = true;

                setTimeout(() => {
                    const { prediction, confidence, advice, numericalStressScore, details } = simulatePrediction(heartRate, sleepHours, workingHours, performance, text);

                    loadingSpinner.classList.add('hidden');
                    analyzeButton.disabled = false;
                    resultContainer.classList.remove('hidden');
                    stressResult.textContent = prediction;
                    adviceMessage.textContent = advice;
                    
                    adviceDetailsList.innerHTML = '';
                    if (details.length > 0) {
                        details.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            adviceDetailsList.appendChild(li);
                        });
                    }

                    let bgColorClass = '';
                    let textColorClass = '';
                    let icon = '';
                    let confidenceColor = '';

                    if (prediction === 'Stressed') {
                        bgColorClass = 'bg-red-50';
                        textColorClass = 'text-red-600';
                        icon = '⚠️';
                        confidenceColor = 'bg-red-500';
                    } else if (prediction === 'Needs Monitoring') {
                        bgColorClass = 'bg-yellow-50';
                        textColorClass = 'text-yellow-600';
                        icon = '👀';
                        confidenceColor = 'bg-yellow-500';
                    }
                    else {
                        bgColorClass = 'bg-emerald-50';
                        textColorClass = 'text-emerald-600';
                        icon = '✅';
                        confidenceColor = 'bg-emerald-500';
                    }
                    
                    resultContainer.className = `mt-8 p-6 rounded-lg ${bgColorClass}`;
                    stressResult.className = `font-bold text-2xl ${textColorClass}`;
                    adviceMessageContainer.className = `flex items-start p-4 rounded-lg ${bgColorClass}`;
                    adviceIcon.textContent = icon;
                    confidenceBar.style.width = `${confidence * 100}%`;
                    confidenceBar.className = `h-2.5 rounded-full transition-all duration-500 ${confidenceColor}`;

                    const now = new Date();
                    const timeString = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                    analysisHistory.unshift({ time: timeString, prediction, heartRate, sleepHours, performance: performanceInput.options[performanceInput.selectedIndex].text, numericalStressScore });
                    
                    renderHistoryTable();
                    renderHistoryChart();

                }, 1500);
            });

            stressedThresholdInput.addEventListener('change', renderHistoryChart);
            monitoringThresholdInput.addEventListener('change', renderHistoryChart);
        });
    </script>
</body>
</html>
